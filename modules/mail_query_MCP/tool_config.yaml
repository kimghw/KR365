version: "1.0"
service:
  name: "MailAttachmentTools"
  handler_class: "MCPHandlers"
  description: "Mail Query and Attachment Processing Service"
  base_classes:
    - "AttachmentFilterHandlers"
    - "CalendarHandlers"

tools:
  - name: "search_messages"
    title: "ğŸ“§ Search Messages"
    description: "Query emails and download/convert attachments to text. Date priority: start_date/end_date > days_back"
    request_class: "dict"  # Using raw dict instead of specific request class
    method_name: "query_email"
    auth_required: true
    auth_field: "user_id"
    # Since this tool has a complex inputSchema, we'll keep it as is
    input_schema:
      type: "object"
      properties:
        user_id:
          type: "string"
          description: "User ID (OPTIONAL - automatically uses authenticated user's ID from session if not provided. Only specify to query a different user's mailbox)"
        use_recent_account:
          type: "string"
          description: "If 'yes', automatically selects the most recently used account (based on last_used_at field). Set to 'yes' when you don't have a specific user_id and want to use the last active account. If 'no' (default), user_id is required."
        days_back:
          type: "integer"
          description: "**DEPRECATED - DO NOT USE**: Number of days to look back. This parameter is deprecated. Instead, you MUST calculate and provide start_date and end_date directly in YYYY-MM-DD format based on the user's request."
          default: 30
        max_mails:
          type: "integer"
          description: "Maximum number of mails to retrieve"
          default: 300
        include_body:
          type: "string"
          description: "Include full email body content in the response. When 'yes', returns complete HTML/text content of each email. When 'no', only returns email preview (first ~255 chars). Useful for detailed content analysis"
          enum: ["yes", "no"]
          default: "yes"
        download_attachments:
          type: "string"
          description: "Download email attachments and convert supported formats (PDF, DOCX, XLSX, etc.) to text. When 'yes', creates local copies and includes text content in response. When 'no', only shows attachment metadata (name, size)"
          enum: ["yes", "no"]
          default: "no"
        save_emails:
          type: "string"
          description: "Save each email as individual text file to disk (mcp_attachments/{user_id}/). Files include headers, body, and attachment list. Useful for archiving or offline access. File names contain subject, date, and sender"
          enum: ["yes", "no"]
          default: "no"
        save_csv:
          type: "string"
          description: "Export all retrieved emails' metadata to a single CSV file. Includes: subject, sender, date, read status, importance, attachment count/names, body preview (100 chars). Excel-compatible format with UTF-8 BOM encoding"
          enum: ["yes", "no"]
          default: "no"
        start_date:
          type: "string"
          description: "**REQUIRED**: Start date in YYYY-MM-DD format. You MUST calculate this from user's request or days_back parameter. Examples: If user says 'last 3 days' or days_back=3, calculate today minus 3 days (e.g., if today is 2025-11-07, start_date='2025-11-04'). For 'this week', use 7 days ago. For 'last month', use 30 days ago. For 'last 3 months', use 90 days ago. Always calculate and provide this field."
        end_date:
          type: "string"
          description: "**REQUIRED**: End date in YYYY-MM-DD format. You MUST calculate this - typically use today's date unless user specifies otherwise. Examples: If today is 2025-11-07, end_date='2025-11-07'. For any relative time period ('this week', 'last month', etc.), end_date should be today. Always calculate and provide this field."
        sender_address:
          type: "string"
          description: "ë°›ì€ ë©”ì¼ í•„í„°: íŠ¹ì • ë°œì‹ ìê°€ ë‚˜ì—ê²Œ ë³´ë‚¸ ë©”ì¼ë§Œ ì¡°íšŒ. ì˜ˆ: 'kim@company.com' â†’ kimì´ ë‚˜ì—ê²Œ ë³´ë‚¸ ë©”ì¼ë§Œ. (ë‚´ê°€ kimì—ê²Œ ë³´ë‚¸ ë©”ì¼ì€ í¬í•¨ ì•ˆ ë¨)"
        subject_contains:
          type: "string"
          description: "Filter emails by subject text. Only emails containing this text in the subject will be retrieved. Case-insensitive partial matching (e.g., 'meeting' matches 'Weekly Meeting Report')."
        keyword:
          type: "string"
          description: "ì „ì²´ ë©”ì¼ ê²€ìƒ‰ í‚¤ì›Œë“œ (í´ë¼ì´ì–¸íŠ¸ ì¸¡ í•„í„°ë§). ì œëª©, ë³¸ë¬¸, ë°œì‹ ì, ìˆ˜ì‹ ì, ì²¨ë¶€íŒŒì¼ëª… ë“± ëª¨ë“  í•„ë“œì—ì„œ ê²€ìƒ‰. ë‚ ì§œ/ë°œì‹ ì í•„í„°ì™€ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥. ë‹¨ìˆœ í‚¤ì›Œë“œ ê²€ìƒ‰ë§Œ ì§€ì›. ì˜ˆ: 'ê³„ì•½ì„œ', 'í”„ë¡œì íŠ¸'. ê³ ê¸‰ ê²€ìƒ‰ì€ keyword_filterë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
        keyword_filter:
          type: "object"
          description: "êµ¬ì¡°í™”ëœ í‚¤ì›Œë“œ ê²€ìƒ‰ í•„í„° (í´ë¼ì´ì–¸íŠ¸ ì¸¡ í•„í„°ë§). AND/OR/NOT ì¡°ê±´ì„ ì¡°í•©í•˜ì—¬ ë³µì¡í•œ ê²€ìƒ‰ ê°€ëŠ¥. ì˜ˆ: {\"and_keywords\": [\"ê³„ì•½ì„œ\", \"2024\"], \"not_keywords\": [\"ì·¨ì†Œ\"]} â†’ ê³„ì•½ì„œì™€ 2024ê°€ ëª¨ë‘ í¬í•¨ë˜ê³  ì·¨ì†ŒëŠ” ì œì™¸"
          properties:
            and_keywords:
              type: "array"
              items:
                type: "string"
              description: "AND ì¡°ê±´: ëª¨ë“  í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•¨. ì˜ˆ: [\"ê³„ì•½ì„œ\", \"2024\"] â†’ ë‘˜ ë‹¤ í¬í•¨"
            or_keywords:
              type: "array"
              items:
                type: "string"
              description: "OR ì¡°ê±´: í•˜ë‚˜ ì´ìƒì˜ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ì•¼ í•¨. ì˜ˆ: [\"ê³„ì•½ì„œ\", \"ì œì•ˆì„œ\"] â†’ ë‘˜ ì¤‘ í•˜ë‚˜ ì´ìƒ"
            not_keywords:
              type: "array"
              items:
                type: "string"
              description: "NOT ì¡°ê±´: ì´ í‚¤ì›Œë“œë“¤ì´ í¬í•¨ë˜ì§€ ì•Šì•„ì•¼ í•¨. ì˜ˆ: [\"ì·¨ì†Œ\", \"ë°˜ë ¤\"] â†’ ë‘˜ ë‹¤ ì œì™¸"
        recipient_address:
          type: "string"
          description: "ë³´ë‚¸ ë©”ì¼ í•„í„°: ë‚´ê°€ íŠ¹ì • ìˆ˜ì‹ ìì—ê²Œ ë³´ë‚¸ ë©”ì¼ë§Œ ì¡°íšŒ. ì˜ˆ: 'kim@company.com' â†’ ë‚´ê°€ kimì—ê²Œ ë³´ë‚¸ ë©”ì¼ë§Œ. (kimì´ ë‚˜ì—ê²Œ ë³´ë‚¸ ë©”ì¼ì€ í¬í•¨ ì•ˆ ë¨)"
        conversation_with:
          type: "array"
          items:
            type: "string"
          description: "ëŒ€í™” ì „ì²´ ì¡°íšŒ: íŠ¹ì • ì‚¬ëŒê³¼ ì£¼ê³ ë°›ì€ ëª¨ë“  ë©”ì¼. ì´ë©”ì¼ ì£¼ì†Œ ë°°ì—´ë¡œ ì…ë ¥. ì˜ˆ: ['kim@company.com', 'lee@company.com'] â†’ â‘ ì´ ì‚¬ëŒë“¤ì´ ë‚˜ì—ê²Œ ë³´ë‚¸ ë©”ì¼ + â‘¡ë‚´ê°€ ì´ ì‚¬ëŒë“¤ì—ê²Œ ë³´ë‚¸ ë©”ì¼ ëª¨ë‘ í¬í•¨. ì™„ì „í•œ ëŒ€í™” ë‚´ì—­ì„ ë³´ë ¤ë©´ ì´ê²ƒì„ ì‚¬ìš©í•˜ì„¸ìš”."
        output_format:
          type: "string"
          description: "Output format for the response. 'json' for structured JSON data (optimized for programmatic access), 'text' for human-readable formatted text (default, easier to read)"
          enum: ["text", "json"]
          default: "text"
        query_context:
          type: "object"
          description: "Query context information for handling multi-turn conversations"
          properties:
            is_first_query:
              type: "string"
              description: "Whether this is the first query in the conversation. When 'yes', all required fields must be provided. When 'no', missing fields may use previous values"
            conversation_turn:
              type: "integer"
              description: "The conversation turn number (1 for first query, 2 for second, etc.)"
            previous_user_id:
              type: "string"
              description: "User ID from the previous query that can be reused if not specified in current query"
      required:
        - "start_date"
        - "end_date"
        - "include_body"
        - "query_context"

  - name: "query_email_help"
    title: "ğŸ“˜ Query Email Help"
    description: "Get detailed usage guide for query_email tool with examples for all parameter combinations"
    request_class: "dict"
    method_name: "query_email_help"
    auth_required: false
    input_schema:
      type: "object"
      properties: {}

  - name: "help"
    title: "â“ Help"
    description: "Get detailed help and documentation for available tools. Use without parameters to see all tools, or specify tool_name for detailed information"
    request_class: "dict"
    method_name: "help"
    auth_required: false
    input_schema:
      type: "object"
      properties:
        tool_name:
          type: "string"
          description: "Name of the tool to get help for (optional). If not specified, shows list of all available tools"
          enum:
            - "query_email"
            - "query_email_help"
            - "help"

# Note: AttachmentFilterHandlers and CalendarHandlers tools are dynamically added by inheritance
# They are not defined here as they come from parent classes

prompts: []  # No prompts currently defined